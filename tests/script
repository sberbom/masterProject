# Remove all running logcats, to ensure no double logging
adb -s $device1 shell killall -2 logcat
adb -s $device2 shell killall -2 logcat
# Clear logs from earlier
echo "" > log_device1.txt
echo "" > log_device2.txt
# Gets the first two connected devices and their id
devices=$(adb devices)
first_line=$(echo $devices | sed -n 2,2p)
second_line=$(echo $devices | sed -n 3,3p)
device1=$(echo $first_line | cut -f1 -d$'\t')
device2=$(echo $second_line | cut -f1 -d$'\t')
echo $device1
echo $device2
adb -s $device1  logcat MulticastClient:D MulticastServer:D RegistrationHandler:D \*:S >> log_device1.txt &
adb -s $device2  logcat MulticastClient:D MulticastServer:D RegistrationHandler:D \*:S >> log_device2.txt &
rounds=1
for i in {1..$rounds}
do
   echo "round $i of $rounds"
   adb -s $device1 shell am start -n com.example.masterproject/com.example.masterproject.activities.MainActivity
   sleep 2
   adb -s $device2 shell am start -n com.example.masterproject/com.example.masterproject.activities.MainActivity
   sleep 2
   adb -s $device1 shell am force-stop com.example.masterproject
   adb -s $device2 shell am force-stop com.example.masterproject
done
adb -s $device1 shell killall -2 logcat
adb -s $device2 shell killall -2 logcat